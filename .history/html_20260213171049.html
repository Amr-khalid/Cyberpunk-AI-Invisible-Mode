<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Rock Paper Scissors - Pure JS Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <style>
      /* ØªÙ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ®Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª */
      * { margin: 0; padding: 0; }
      body { overflow: hidden; object-fit: contain; background-color: #333; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
      .box { display: flex; justify-content: space-between; width: 100vw; }
      .humans, .ais {
        height: 40px; backdrop-filter: blur(10px); color: white; font-weight: bold; outline: none; border: none;
        box-shadow: 2px 2px 10px black; text-align: center; width: 120px;
      }
      .humans { background: linear-gradient(to right, #00000030, rgba(91, 91, 91, 0.21)); border-end-start-radius: 50px; border-right: 4px solid rgba(255, 255, 255, 0.199); }
      .ais { background: linear-gradient(to left, #00000022, rgba(91, 91, 91, 0.227)); border-end-end-radius: 50px; }
      img { width: 45vw; height: auto; transition: 0.5s; }
      .ai { animation: br 4s infinite; }
      @keyframes br { 0% { filter: drop-shadow(0 0 50px #532e1f73); } 100% { filter: drop-shadow(0 0 10px rgb(0, 0, 0)); } }
      .start { animation: strat 0.4s infinite; }
      @keyframes strat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
      button { font-size: 2.5rem; background: transparent; border: none; cursor: pointer; transition: 0.2s; }
      button:hover { transform: scale(1.2); }
      #countdown { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: bold; color: white; text-shadow: 0 0 30px black; display: none; z-index: 999; }
    </style>
  </head>
  <body>
    <video id="video" autoplay playsinline style="display: none;"></video>
    <canvas id="output" width="640" height="480" style="position:fixed; right:10px; bottom:10px; width:200px; border:2px solid #000; opacity: 0.7; z-index: 100;"></canvas>

    <div id="countdown">3</div>
    <button id="reset" style="position: fixed; top: 10px; left: 10px; font-size: 14px; color: #aaa; z-index: 555;">[ RESET SCORE ]</button>

    <img src="public/bg2.png" id="bg" style="position: fixed; width: 100%; height: 100%; z-index: -1; object-fit: cover;" />

    <div style="display: flex; justify-content: center; width: 100%; position: fixed; top: 0; z-index: 10; padding-top: 10px;">
      <input type="text" readonly id="humanScore" value="Human: 0" class="humans" />
      <input type="text" readonly id="aiScore" value="Ai: 0" class="ais" />
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
      <div class="box">
        <div class="human"><img src="public/rh.png" id="humanHand" /></div>
        <div class="ai"><img src="public/rr.png" id="aiHand" /></div>
      </div>
      <div style="margin-top: 30px; z-index: 20">
        <button id="rock">ğŸ‘Š</button>
        <button id="paper">âœ‹</button>
        <button id="scissors">âœŒï¸</button>
      </div>
    </div>

    <script>
      // --- Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø§Ù„Ø³ÙƒÙˆØ± (Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø§ÙŠØ«ÙˆÙ†) ---
      let stats = JSON.parse(localStorage.getItem('rps_stats')) || { wins: 0, losses: 0 };
      
      function updateScoreUI() {
        document.getElementById("humanScore").value = `Human: ${stats.wins}`;
        document.getElementById("aiScore").value = `Ai: ${stats.losses}`;
        localStorage.setItem('rps_stats', JSON.stringify(stats));
      }
      updateScoreUI();

      // --- Variables ---
      let countdownRunning = false;
      const moveMap = ["rock", "paper", "scissors"];
      const aiImages = { rock: "public/rr.png", paper: "public/pr.png", scissors: "public/sr.png" };
      const humanImages = { rock: "public/rh.png", paper: "public/ph.png", scissors: "public/sh.png" };

      // --- MediaPipe Hand Detection ---
      const video = document.getElementById("video");
      const canvas = document.getElementById("output");
      const ctx = canvas.getContext("2d");

      function countFingers(landmarks) {
        const tips = [8, 12, 16, 20]; 
        let count = 0;
        tips.forEach(tip => { if (landmarks[tip].y < landmarks[tip - 2].y) count++; });
        return count;
      }

      const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
      hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });

      hands.onResults(results => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
          const landmarks = results.multiHandLandmarks[0];
          drawConnectors(ctx, landmarks, HAND_CONNECTIONS);
          drawLandmarks(ctx, landmarks);
          
          if (!countdownRunning) {
            const fingers = countFingers(landmarks);
            let move = fingers === 0 ? "rock" : (fingers === 2 ? "scissors" : (fingers >= 4 ? "paper" : null));
            if (move) { /* ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¨Ø¯Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‡Ù†Ø§ */ }
          }
        }
      });

      const camera = new Camera(video, { onFrame: async () => { await hands.send({ image: video }); }, width: 640, height: 480 });
      camera.start();

      // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© (The AI Logic) ---
      function playRound(humanMove) {
        const aiMove = moveMap[Math.floor(Math.random() * 3)];
        
        document.getElementById("humanHand").src = humanImages[humanMove];
        document.getElementById("aiHand").src = aiImages[aiMove];

        let resultText = "";
        if (humanMove === aiMove) {
          resultText = "DRAW";
          document.getElementById("bg").src = "public/bg2.png";
        } else if (
          (humanMove === "rock" && aiMove === "scissors") ||
          (humanMove === "paper" && aiMove === "rock") ||
          (humanMove === "scissors" && aiMove === "paper")
        ) {
          resultText = "YOU WIN!";
          stats.wins++;
          document.getElementById("bg").src = "public/bgh.png";
        } else {
          resultText = "YOU LOSE";
          stats.losses++;
          document.getElementById("bg").src = "public/bgr.png";
        }

        const cd = document.getElementById("countdown");
        cd.innerText = resultText;
        cd.style.display = "block";
        setTimeout(() => { cd.style.display = "none"; }, 1500);
        updateScoreUI();
      }

      function startAnimation(choice) {
        if (countdownRunning) return;
        countdownRunning = true;
        let n = 3;
        const cd = document.getElementById("countdown");
        cd.style.display = "block";
        cd.innerText = n;

        const timer = setInterval(() => {
          n--;
          if (n > 0) {
            cd.innerText = n;
          } else {
            clearInterval(timer);
            cd.style.display = "none";
            countdownRunning = false;
            playRound(choice);
          }
        }, 800);
      }

      document.getElementById("rock").onclick = () => startAnimation("rock");
      document.getElementById("paper").onclick = () => startAnimation("paper");
      document.getElementById("scissors").onclick = () => startAnimation("scissors");
      document.getElementById("reset").onclick = () => { stats = { wins: 0, losses: 0 }; updateScoreUI(); };
    </script>
  </body>
</html>